<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Detección de ejercicios de labios (MediaPipe)</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Arial;
      margin: 0; padding: 16px; display: grid; gap: 16px; justify-items: center;
      background: #0b0e11; color: #e8e8e8;
    }
    .app { display: grid; gap: 12px; width: min(1000px, 100%); }
    .controls, .status, .recording {
      display: flex; flex-wrap: wrap; align-items: center; gap: 12px 16px;
      background: #131821; padding: 12px; border-radius: 10px; border: 1px solid #283043;
    }
    button, .pill {
      padding: 8px 12px; border-radius: 8px;
    }
    button {
      border: 1px solid #33538a; background: #1a2a4a; color: #e8f0ff; cursor: pointer;
    }
    button:disabled { opacity: .6; cursor: not-allowed; }
    label { display: inline-flex; gap: 8px; align-items: center; user-select: none; }
    .pill {
      background: #223050; border: 1px solid #2e3d5e; font-variant-numeric: tabular-nums;
    }
    .pill.ok { background: #2d5a2c; border-color: #3f7b3e; }
    .pill.warn { background: #5a3a2c; border-color: #7b513e; }
    .video-wrap {
      position: relative; width: 100%; aspect-ratio: 4 / 3; background: #10151c;
      border-radius: 12px; overflow: hidden; border: 1px solid #283043;
    }
    video, canvas {
      position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover;
      transform: scaleX(-1);
    }
    .grid { display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(210px, 1fr)); }
    .legend { font-size: .9rem; opacity: .85; }
  </style>
</head>
<body>
  <div class="app">
    <h1>Detección de ejercicios de labios</h1>

    <div class="controls">
      <button id="startBtn">Iniciar cámara + micrófono</button>
      <button id="resetBtn" disabled>Reiniciar detectores</button>
      <label><input id="showLips" type="checkbox" checked /> Mostrar contorno de labios</label>
      <span id="statePill" class="pill">Estado: esperando…</span>
      <span id="fpsPill" class="pill">fps: —</span>
    </div>

    <div class="recording">
      <button id="recordBtn" disabled>Grabar</button>
      <button id="stopRecBtn" disabled>Detener</button>
      <span id="recPill" class="pill">Grabación: inactiva</span>
    </div>

    <div class="video-wrap">
      <video id="inputVideo" playsinline muted></video>
      <canvas id="outputCanvas"></canvas>
    </div>

    <div class="status grid">
      <div class="pill" id="p-trompa">Trompa Lateral: —</div>
      <div class="pill" id="p-fruncir">Fruncir y Sonreír: —</div>
      <div class="pill" id="p-mantener">Mantener Trompa: 0%</div>
      <div class="pill" id="p-morder">Morder Labios: —</div>
      <div class="pill" id="p-besos">Besos Ruidosos: —</div>
      <div class="pill" id="p-sopapa">Sello de Sopapa: —</div>
      <div class="pill" id="p-vibrar">Vibrar Labios: —</div>
    </div>

    <p class="legend">
      Corre en HTTPS (GitHub Pages) o localhost. Si no funciona el audio o el video, revisa permisos del navegador.
      Al grabar, se descarga un .webm (video+audio) y un .json (log de detecciones).
    </p>
  </div>

  <!-- MediaPipe (FaceMesh clásico con APIs globales) -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh@0.4/face_mesh.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3/drawing_utils.js"></script>

  <!-- App -->
  <script type="module" src="./app.js"></script>
</body>
</html>